[macro-user-callerid-custom]
exten => s,33,Set(Rota33=33)
exten => s,n,Set(GLOBAL(SISTEMA_SIGMA)=true)
exten => s,n,Set(INTERFONE_CLI=${CALLERID(name)})
exten => s,n,Noop(${LEN(${CDR(accountcode)})})
exten => s,n,Noop(${LEN(${CALLERID(name)})})
exten => s,n,Noop(${INTERFONE})
exten => s,n,Noop(${INTERFONE_CLI})
exten => s,n,Set(ONEDISCADOR=${CDR(accountcode)})
exten => s,n,GotoIf($["${CDR(accountcode)}" = "URA" ]?OneDiscador)
exten => s,n,Noop(${ONEDISCADOR})
;exten => s,n,Set(CDRNAME=${CDR(accountcode)})
;exten => s,n,Set(GLOBAL(CDR_GRAVACAO)=${UNIQUEID})
exten => s,n,Verbose(${LOOPEVENTO})
exten => s,n,Verbose(${REGEX("^[A-Za-z0-9]" ${CALLERID(name)})})
exten => s,n,GotoIf($["${LOOPEVENTO}" > "0"]?Log)
exten => s,n,GotoIf($[ $[ $[ "${LEN(${CALLERID(name)})}" = "7" ] & $[ "${CALLERID(num)}" != "${CALLERID(name)}"  ] & $[ "${REGEX("^[0-9]" ${CALLERID(name)})}" = "1" ] ] ]?RotaCID)
exten => s,n,GotoIf($["${LEN(${CDR(accountcode)})}" = "7"]?RotaCDR:Log)

exten => s,50(RotaCID),Set(CIDNAME=${UNIQUEID})
exten => s,n(RotaCID),Set(FILE(/tmp/${UNIQUEID}.txt)=${CALLERID(name)})
exten => s,n(RotaCID),GotoIf($["${Rota33}" = "33"]?GeraEventoCID33:GeraEventoCID32)
exten => s,n(GeraEventoCID33),Set(URL1=${CURL(http://192.168.235.50/wsOnePortaria/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})})
exten => s,n(GeraEventoCID33),Set(URL1=${CURL(http://192.168.235.50/wsOnePortariaSIGMA/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})})
;exten => s,n(GeraEventoCDR33),System(/usr/bin/curl --connect-timeout 2 "http://127.0.0.1/MoniDiscador/?sigma=${CDR(accountcode)}&gravacao=${UNIQUEID}&interfone=${INTERFONE}&numero_discado=${EXTEN}")
exten => s,n(GeraEventoCID33),Set(LOOPEVENTO=1)
;exten => s,n(GeraEventoCDR33),Set(LOOPEVENTO=${UNIQUEID})

exten => s,60(GeraEventoCID32),Set(URL1=${CURL(http://192.168.235.50/wsOnePortaria/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})})
exten => s,n(GeraEventoCID32),Set(URL1=${CURL(http://192.168.235.50/wsOnePortariaSIGMA/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})})
;exten => s,n(GeraEvento32),Set(LOOPEVENTO=${UNIQUEID})
exten => s,n(GeraEventoCID32),Set(LOOPEVENTO=1)

exten => s,70(RotaCDR),Set(CDRNAME=${UNIQUEID})
exten => s,n(RotaCDR),Set(FILE(/tmp/${UNIQUEID}.txt)=${CDR(accountcode)})
exten => s,n(RotaCDR),GotoIf($["${Rota33}" = "33"]?GeraEventoCDR33:GeraEventoCDR32)
exten => s,n(GeraEventoCDR33),Set(URL1=${CURL(http://192.168.235.50/wsOnePortaria/?tag=0&evento=OINI&conta=${CDR(accountcode):3:7}&auxiliar=${CDR(accountcode):0:3})})
exten => s,n(GeraEventoCDR33),Set(URL1=${CURL(http://192.168.235.50/wsOnePortariaSIGMA/?tag=0&evento=OINI&conta=${CDR(accountcode):3:7}&auxiliar=${CDR(accountcode):0:3})})
;exten => s,n(GeraEventoCDR33),System(/usr/bin/curl --connect-timeout 2 "http://127.0.0.1/MoniDiscador/?sigma=${CDR(accountcode)}&gravacao=${UNIQUEID}&interfone=${INTERFONE}&numero_discado=${EXTEN}")
exten => s,n(GeraEventoCDR33),Set(LOOPEVENTO=1)
;exten => s,n(GeraEventoCDR33),Set(LOOPEVENTO=${UNIQUEID})

exten => s,80(GeraEventoCDR32),Set(URL1=${CURL(http://192.168.235.50/wsOnePortaria/?tag=0&evento=OINI&conta=${CDR(accountcode):3:7}&auxiliar=${CDR(accountcode):0:3})})
exten => s,n(GeraEventoCDR32),Set(URL1=${CURL(http://192.168.235.50/wsOnePortariaSIGMA/?tag=0&evento=OINI&conta=${CDR(accountcode):3:7}&auxiliar=${CDR(accountcode):0:3})})
;exten => s,n(GeraEventoCDR32),System(/usr/bin/curl --connect-timeout 2 "http://127.0.0.1/MoniDiscador/?sigma=${CDR(accountcode)}&gravacao=${UNIQUEID}&interfone=${INTERFONE}&numero_discado=${EXTEN}")
;exten => s,n(GeraEvento32),Set(LOOPEVENTO=${UNIQUEID})
exten => s,n(GeraEventoCDR32),Set(LOOPEVENTO=1)

exten => s,90(Log),Noop(Nada a fazer)

exten => s,800(OneDiscador),Noop(Gravar id da ligacao no sigma)
exten => s,n(OneDiscador),Noop(ligacao)
;exten => s,n,DumpChan()
exten => s,n(OneDiscador),System(/usr/bin/curl --connect-timeout 2 "http://127.0.0.1/MoniDiscador/?sigma=${CDR(accountcode)}&gravacao=${CDR(linkedid)}&interfone=${FROMEXTEN}&numero_discado=${MACRO_EXTEN}")

[macro-auto-blkvm-custom]
exten => s,9,Noop(Atendeu)  
exten => s,n,Noop(${UNIQUEID})
exten => s,n,Noop(${ENTITYID})
exten => s,n,Noop(${CDRNAME})
exten => s,n,Noop(${EPOCH})
;exten => s,n,DumpChan()
exten => s,n,Noop(${FROMEXTEN})
exten => s,n,Noop(${CDR(linkedid)})

exten => s,n,ExecIf($["${SISTEMA_SIGMA}" = "true"]?System(/usr/bin/curl --connect-timeout 2 "http://127.0.0.1/MoniDiscador/?sigma=${FILE(/tmp/${CDR(linkedid)}.txt)}&gravacao=${CDR(linkedid)}&interfone=${FROMEXTEN}&numero_discado=${EXTEN}"))
;exten => s,n,System(/usr/bin/curl --connect-timeout 2 "http://127.0.0.1/MoniDiscador/?sigma=${FILE(/tmp/${CDR(linkedid)}.txt)}&gravacao=${CDR(linkedid)}&interfone=${FROMEXTEN}&numero_discado=${EXTEN}")
exten => s,n,System(rm -rf /tmp/${CDR(linkedid)}.txt)
;exten => s,n,System(rm -rf /tmp/${CDRNAME}-interfone.txt)
;exten => s,n,Set(CDRNAME=)
;exten => s,n,Set(CDR_GRAVACAO=)
;exten => s,n,System(/usr/bin/curl "http://127.0.0.1/MoniDiscador/?sigma=${CDR(accountcode)}&gravacao=${UNIQUEID}&interfone=${INTERFONE}")

;[macro-user-callerid-custom]
;include => from-internal
;exten => s,33,Set(URL1=${CURL(http://192.168.235.50/wsOnePortariaSIGMA/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})})
;exten => s,n,Set(URL1=${CURL(http://192.168.235.50/wsOnePortaria/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})})
;exten => s,n,Noop(http://192.168.235.50/wsOnePortaria/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3})
;exten => s,n,Set(URL1=(http://10.0.0.2/wsOnePortaria/?tag=0&evento=OINI&conta=${CALLERID(name):3:7}&auxiliar=${CALLERID(name):0:3}))
;exten => s,n,Set(URL2=${CURL(http://192.168.117.50:8080/SigmaWebServices/notifyCall?userfield=${CDR(accountcode)}&clientid=${CDR(accountcode)}&exten=${CALLERID(num)}&eventid=OINT&callerid=${CALLERID(num)})})
